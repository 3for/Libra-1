%!TEX root = fastZKP.tex


\section{Zero Knowledge Sumcheck}
\subsection{Intuition}
In $GKR$ protocol, for every layer of the circuit, the prover needs to prove one equation to the verifier based on the sumcheck protocol. That means if we want to get the zero knowledge $GKR$ protocol, we should first design an efficient zero knowlege sumcheck protocol.\\

\noindent
For sumcheck protocol, the prover needs to prove $a = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}F(x_1, x_2, \cdots, x_n)$ to the verifier. And the verifier accepts if and only if it verifies $f_{i-1}(r_{i-1}) = f_i(0) + f_i(1)$ for every round and $s = F(r_1, r_2, \cdots, r_n)$ at the end of the protocol, where $r_1, r_2, \cdots, r_n$ are randomly chosen by the verifier and $s$ is given by the oracle. We could use verifiable polynomial delegation(VPD) to be the oracle to confirm verifier the value of $F(r_1, r_2, \cdots, r_n)$. Zero knowledge sumcheck means that the verifier could learn nothing about the polynomial $F$ except for the value of $a$ and the query value of $s$ on $r_1, r_2, \cdots, r_n$.\\

\noindent
The idea to make sumcheck protocol zero knowledge is very easy. We hope to use another sumcheck polynomial with the same individual degree and variables to mask $\sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}F(x_1, x_2, \cdots, x_n)$. In addition, we hope that the mask polynomial is as simple as possible since the time complexity of VPD is related to the number of monomials in the mask polynomial.\\

\subsection{Protocol}
\noindent
Consider the simplest example, where $F(x_1, x_2, \cdots, x_n)$ is a multilinear polynomial. Then we could use a very simple function $G(x_1, x_2, \cdots, x_n) = a_0 + a_1x_1 + a_2x_2 + \cdots + a_nx_n$ to mask $F$, where $a_0, a_1, \cdots, a_n$ is randomly chosen from $\mathbb{F}$. Suppose that $b = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}G(x_1, x_2, \cdots, x_n)$ and we would use the sumcheck protocol to verify

$$a + \rho b = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}[F(x_1, x_2, \cdots, x_n) + \rho G(x_1, x_2, \cdots, x_n)]$$. 

Where $\rho$ is randomly chosen by the verifier $\mathcal{V}$. In the beginning of sumcheck protocol, the prover sends the summation to the verifier firstly. Later on, the prover sends $h_i(x_i)(h_i = f_i + \rho g_i)$ to the verifier in round $i$, where $1 \leq i \leq n$. And the verifier computes $h_i(0) + h_i(1) = h_{i-1}(r_{i-1})$. Finally, the verifier queries $F(r_1, r_2, \cdots, r_n)$, $G(r_1, r_2, \cdots, r_n)$ and verifies $h_n(r_n) = F(r_1, r_2, \cdots, r_n) + \rho G(r_1, r_2, \cdots, r_n)$. In our simple example, where $F$ and $G$ are multilinear, the prover could use $h_i(0)$ and $h_i(1)$ to replace $h_i(x_i)$. Suppose the verifier is $\mathcal{V}$ and the prover is $\mathcal{P}$. The formal protocol on the claim $a = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}} F(x_1, x_2, \cdots, x_n)$ as follows.\\

\noindent
\begin{enumerate}

\item $\mathcal{P}$ uniformly choose a function $G(x_1, x_2, \cdots, x_n) = a_0 + a_1x_1 + a_2x_2 + \cdots + a_nx_n$ at random. Then $\mathcal{P}$ sends $a = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}} F(x_1, x_2, \cdots, x_n)$ and $b = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}} G(x_1, x_2, \cdots, x_n)$ to $\mathcal{V}$.
\item $\mathcal{V}$ uniformly sample $\rho \in \mathbb{F}$, and sends $\rho$ to $\mathcal{P}$.
\item $\mathcal{P}$ and $\mathcal{V}$ run the sumcheck protocol on the claim
$$a + \rho b = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}[F(x_1, x_2, \cdots, x_n) + \rho G(x_1, x_2, \cdots, x_n)]$$
\item At the last round of the sumcheck protocol, $\mathcal{V}$ sends $r_n$ to $\mathcal{P}$. And $\mathcal{P}$ replies with $s = F(r_1, r_2, \cdots, r_n)$ and $t = G(r_1, r_2, \cdots, r_n)$, where $r_1, r_2, \cdots, r_n$ are randomly sampled by $\mathcal{V}$. 
\item If $s + \rho t \neq h_n(r_n)(h_n = f_n + \rho g_n)$, $\mathcal{V}$ rejects. Otherwise, $\mathcal{V}$ and $\mathcal{P}$ run the zero knowledge VPD protocol to verify $s = F(r_1, r_2, \cdots, r_n)$ and $t = G(r_1, r_2, \cdots, r_n)$.  

\end{enumerate}
\noindent
\textbf{Completeness}. It is obvious that the zero knowledge sumcheck protocol satifies the completeness property.\\

\noindent
\textbf{Soundness}. Let $\mathcal{P}^*$ be a cheating prover which convinces $\mathcal{V}$ of a claim ``$a = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}F(x_1, x_2, \cdots, x_n)$'' such that $a \neq \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}F(x_1, x_2, \cdots, x_n)$ actually. If $a \neq \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}F(x_1, x_2, \cdots, x_n)$, then $a + \rho b \neq \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}F(x_1, x_2, \cdots, x_n) + \rho \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}G(x_1, x_2, \cdots, x_n)$ with probability $1 - 1 / \mathbb{F}$. And we also know the soundness of sumcheck protocol for $n$ variables and individual degree $d$ is $d n /|\mathbb{F}|$. Therefore, $\mathcal{V}$ accepts with probability at most $(1 + dn) / |\mathbb{F}|$. Since the soundness of zero knowledge VPD is negligible of $\lambda$, the soundness of zero knowledge sumcheck protocol is also negligible of $\lambda$.\\

\noindent
\textbf{Zero knowledge}. We prove that the protocol's has perfect zero knowledge by exhibiting a polynomial-time simulator $\mathcal{S}$ with $a = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}F(x_1, x_2, \cdots, x_n)$ that perfectly samples the view of any malicious verifier. The simulator $\mathcal{S}$ given straightline access to $\mathcal{V^*}$ and the oracle access to $f$, works as follows.

\begin{enumerate}

\item Draw a multilinear polynomial $Z_{sim} = a_0 + a_1x_1 + \cdots + a_nx_n$, where $a_0, a_1, \cdots, a_n$ are uniformly randomly chosen from $\mathbb{F}$. 

\item Draw a multilinear polynomial $Q_{sim} \in \mathbb{F}[x_{1, 2, \cdots, n}^{\leqslant 1}]$ uniform at random conditioned on $a = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}Q_{sim}(x_1, x_2, \cdots, x_n)$.

\item Begin simulating $\mathcal{V}^*$. The simulator sends $a = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}Q_{sim}(x_1, x_2, \cdots, x_n)$ and $b = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}Z_{sim}(x_1, x_2, \cdots, x_n)$ to $\mathcal{V}^*$. 

\item $\mathcal{S}$ receives $\rho$ from $\mathcal{V^*}$, then engage in the sumcheck protocol on the claim ``$\sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}Q_{sim}(x_1, x_2, \cdots, x_n) + \rho Z_{sim}(x_1, x_2, \cdots, x_n) = a + \rho b$''. 

\item Let $\vec{r} \in \mathbb{F}^n$ be the point chosen by $\mathcal{V}^*$ in the sumcheck protocol. $\mathcal{S}$ sends $s = Q_{sim}(\vec{r})$ and $t = Z_{sim}(\vec{r})$ to $\mathcal{V^*}$. 

\item $\mathcal{V}^*$ utilizes zero knowledge VPD protocol to verify $s = Q_{sim}(\vec{r})$ and $t = Z_{sim}(\vec{r})$. 

\end{enumerate} 

If we would like to prove this protocol is zero knowledge. We need to argue that in the real world, the distribution of $F(x_1, x_2, \cdots, x_n)$ should be uniformly at random conditioned on
$$\sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}F(x_1, x_2, \cdots, x_n) = a$$.

In every round $i$ of the sumcheck, the verifier only receives $h_i(0) = f_i(0) + \rho g_i(0)$ and $h_i(1) = f_i(1) + \rho g_i(1)$. Since the verifier knows $h_{i-1}(0) = f_i(0) + \rho g_i(0)$ and $h_{i-1}(1) = f_{i-1}(1) + \rho g_{i-1}(1)$ and the random number $r_{i-1}$ in previous round, the verifier could get $h_{i}(1)$ itself if he knows $h_{i}(0)$ as $h_{i}(0) + h_{i}(1) = h_{i-1}(r_{i-1}) = (1 - r_{i-1})h_{i-1}(0) + r_{i-1}h_{i-1}(1)$ for honest prover. So the actual valid information for the verifier is $h_{1}(0), h_{2}(0), \cdots, h_{n}(0)$. We hope that the verifier could learn nothing of $F(x_1, x_2, \cdots, x_n)$ except for $a$ using these information. In other words, the mask polynomial $G(x_1, x_2, \cdots, x_n)$ would hide the information of $F$. Therefore, the verifier wants to remove the information of $G$ but remains some information about $F$. That is equavilent to $g(0), g_{1}(0), g_{2}(1), \cdots, g_{n}(0)$ are linear independent about random variables $a_0, a_1, \cdots, a_n$.

\begin{proof}
Consider that if we run the sumcheck only for $G(x_1, x_2, \cdots, x_n)$. The verifier could know exactly what $G(x_1, x_2, \cdots, x_n)$ is. The reason is that the verifier could know $g_{i}(0)$ and $g_{i}(1)$, and $G$ is a linear function of $x_i$, so it is easy to compute the coefficient of $x_i$, which is $a_i$ for $i$ from 1 to $n$. Finally, since the verifier knows $b = \sum\limits_{x_1, x_2, \cdots, x_n \in \{0, 1\}}G(x_1, x_2, \cdots, x_n)$, he could compute $a_0$. So the verifier could get the exact function $G$ after sumcheck.\\  

Notice that in this sumcheck, the valid information for the verifier is still $g(0), g_{1}(0), \cdots, g_{n}(0)$. The verifier has only $n + 1$ equations about $n$ variables and could get the exact value of $a_0, a_1, \cdots, a_n$. Therefore, $g(0), g_{1}(0), \cdots, g_{n}(0)$ must be linear independent about random variables $a_0, a_1, \cdots, a_n$.
\end{proof}

That means $F$ and $Q_{sim}$ is inditinguishable for any verifier. Besides, both of $G$ and $Z_{sim}$ are uniformly at random, so they are also indistinguishable for the verifier. By hybrid argument, we could know that $\{View_{V^*}(\mathcal{P}(a, F) \leftrightarrow \mathcal{V^*}(a))\} \simeq_{c} \{\mathcal{S}^{\mathcal{V^*}}(a)\}$, which means it is zero knowledge.\\

\noindent
Now we could move to the general case, where the individual degree of $F$ is $d$. Using the same idea of mask polynomial, we could denote by $G = a_{0} + G_1(x_1) + G_2(x_2) + \cdots + G_n(x_n)$, where $G_{i}(x_i) = a_{i1}x_i + a_{i2}x_i^2 + \cdots + a_{id}x_i^d$. And all coefficients of $G$ are uniformly randomly chosen from $\mathbb{F}$. And in the sumcheck protocol, the prover needs to send $d+1$ values $g_{i}(0), g_{i}(1), \cdots, g_i(d)$ to the verifier. And the zero knowledge proof is very similar to the above proof. \\

\noindent
\textbf{Complexity}. Consider the time complexity of the prover $\mathcal{P}$. The prover time consists of sampling a polynomial $G$, running sumcheck protocol and zero knowledge sumcheck protocol. Since the complexity of the general sumcheck protocol for $F$ is determined by the self property of $F$, we only consider the overhead complextiy while maintaining zero knowledge property. Suppose $F$ has $n$ variables with individual degree at most $d$. Then the sample complexity is $\mathcal{O}(nd)$ and running sumcheck protocol for mask polynomial $G$ is $\mathcal{O}(nd)$. Besides, the zero knowledge VPD for $G(r_1, r_2, \cdots, r_n)$ runs in total time $\mathcal{O}(n^2d^2)$. So the total overhead complexity is $\mathcal{O}(n^2d^2)$.  

\section{Zero knowledge GKR}

For GKR protocol, we want to make it zero knowledge since we hope that the verifier has no idea about the input and the value of the gates in the circuit $C$. However, although we have above zero knowledge sumcheck protocol, the GKR protocol would still leak some information when it generates from current circuit layer to next circuit layer. We try to prevent this leakage.\\

We introduce some notations before the proof. We denotes by $Z(z_1, z_2, \cdots, z_n) = z_1(1-z_1)z_2(1-z_2) \cdots z_n(1-z_n)$, it is to easy to find that $Z(z)$ is zero on $\{0, 1\}^n$ and nonzero on $(\mathbb{F} - \{0, 1\})^n$. The intuition is as follows. We would like to use $Z(z) \sum\limits_{c \in \{0, 1\}}R(z, c)$ to mask $V(z)$ and get a low degree extension of $V(z)$.

\begin{align*}
\dot{V}_{i}(z) \overset{def}{=}\sum_{g\in\{0,1\}^{s_i} u, v\in \{0,1\}^{s_{i+1}}}\tilde{\beta}(z, g)\tilde{mult}(g, u, v)(\dot{V}_{i+1}(u)\dot{V}_{i+1}(v))&+\tilde{add}(g,u,v)(\dot{V}_{i+1}(u)+\dot{V}_{i+1}(v))\\
 &+ Z_i(z)\sum\limits_{c \in \{0, 1\}}R_i(z, c)\\
\end{align*}

\begin{align*}
\dot{V}_{i}(z) = \sum_{g\in\{0,1\}^{s_i} u, v\in \{0,1\}^{s_{i+1}}c \in \{0, 1\}}[c\tilde{\beta}(z, g)\tilde{mult}(g, u, v)(\dot{V}_{i+1}(u)\dot{V}_{i+1}(v))&+\tilde{add}(g,u,v)(\dot{V}_{i+1}(u)+\dot{V}_{i+1}(v))\\
 &+ I((\vec{g}, \vec{u}, \vec{v}), \vec{0})Z_i(z)\sum\limits_{c \in \{0, 1\}}R_i(z, c)]
\end{align*}
$I((\vec{g}, \vec{u}, \vec{v}), \vec{0}) = 1$ if $(\vec{g}, \vec{u}, \vec{v}) = \vec{0}$, otherwise $I((\vec{g}, \vec{u}, \vec{v}), \vec{0}) = 0$. Then we could do sumcheck protocol for $\dot{V}_i(z)$ together with the variable $c$. And in the final round of the sumcheck protocol for $\dot{V}_i(z)$, the prover would give $R_i(r, p)$ to the verifier, where $r \in \mathbb{F}^{s_i}, p \in \mathbb{F}$ are randomly chosen by the verifier. We hope that even if the verifier know the value of $R_i(r, p)$. It has no idea of $\sum\limits_{c \in \{0, 1\}}R_i(r, c)$. That means the value of $\sum\limits_{c \in \{0, 1\}}R(r, c)$ is still random from the verifier's perspective. Consequently, it achieves the hideness of $V(z)$. Observe first that $R_i$ is a perfectly-hiding commitment to the random polynomial $S_i(z) = \sum\limits_{c \in \{0, 1\}}R_i(z, c)$, and so $S_i(z)$ itself is uniformly random even conditioned on only one query to $R_i$. Considering the time complexity, we hope the function $R_i$ is as small as possible. Hence, we define $R_i(z, c) = R_i'(z_1, c)$, where $R_i'(z_1, c)$ is a random function of two variables with degree two. There is a formal protocol as follows.\\ 

\begin{enumerate} 
\item The prover $\mathcal{P}$ gives $\text{Output}$ of the circuit $\dot{V}_0(0)$ to the verifier $\mathcal{V}$. 
\item $\mathcal{P}$ samples $R_1(X, Y), R_2(X, Y), \cdots, R_d(X, Y)$ randomly from $\mathbb{F}[X^{\leqslant 2}, Y^{\leqslant 2}]$
\item $\mathcal{P}$ and $\mathcal{V}$ run the zero knowledge sumcheck protocol on the claim:
$$\dot{V}_0(0) = \sum_{g\in\{0,1\} u, v\in \{0,1\}^{s_1}}\tilde{\beta}(0, g)\tilde{mult}(g, u, v)(\dot{V}_1(u)\dot{V}_1(v))+\tilde{add}(g,u,v)(\dot{V}_1(u)+\dot{V}_1(v))$$

At the end of the sumcheck protocol, $\mathcal{P}$ sends $\dot{V}_1(r)$ and $\dot{V}_1(s)$ to $\mathcal{V}$ if $r_1 \neq s_1$, where $r, s$ are randomly chosen by $\mathcal{V}$, If $r_1 = s_1$ $\mathcal{P}$ aborts. If it does not pass the sum check protocol, $\mathcal{V}$ rejects. 

\item For layer $i(1 \leq i \leq d - 1)$:
	\begin{itemize}
	\item $\mathcal{V}$ samples $\alpha_1, \alpha_2$ at random and sends them to $\mathcal{P}$.
	\item $\mathcal{V}$ and $\mathcal{P}$ run the zero knowledge sumcheck on the claim
	$$\alpha_1 \dot{V}_i(r) + \alpha_2 \dot{V}_i(s) = \alpha_1 a_{r} + \alpha_2 a_{s}$$
	Let $z^{(1)} = r$ and $z^{(2)} = s$.
	\item At the end of the sumcheck protocol, $\mathcal{P}$ receives the random vector $t, r, s, p$ with $t \in (\mathbb{F} - \{0, 1\})^{s_i}$ $r, s \in (\mathbb{F} - \{0, 1\})^{s_{i+1}}$ and $p \in \mathbb{F}$. 
	\begin{align*}
		\sum_{j = 1, 2} \alpha_j (\tilde{\beta}(z^{(j)}, t)\tilde{mult}(t, r, s)(\dot{V}_{i+1}(r)\dot{V}_{i+1}(s))&+\tilde{add}(t,r,s)(\dot{V}_{i+1}(r)+\dot{V}_{i+1}(s))\\
 		&+ Z_i(z^{(j)})\sum\limits_{c \in \{0, 1\}}R_i(z^{(j)}_1, c))
	\end{align*}
	\item If $r_1 = s_1$, abort. 
	\item $\mathcal{P}$ replies with the value $a_r = \dot{V}_{i+1}(r)$, $a_s = \dot{V}_{i+1}(s)$ and $a, b$.
	\item $\mathcal{P}$ and $\mathcal{V}$ run zero knowledge VPD on claims $a = R_i(z^{(1)}_1, p)$ and $b = R_i(z^{(2)}_1, p)$. If $\mathcal{P}$ does not pass the sumcheck protocol or VPD protocol, $\mathcal{V}$ rejects.
	\end{itemize}

\item For input layer $d$, $\mathcal{P}$ and $\mathcal{V}$ run the zero knowledge VPD protocol on the claim $\dot{V}_d(r) = \tilde{V}_d(r) + Z(r)\sum\limits_{c \in \{0, 1\}}R_d(r_1, c)$ and $\dot{V}_d(s) = \tilde{V}_d(s) + Z(s)\sum\limits_{c \in \{0, 1\}}R_d(s_1, c)$. $\mathcal{V}$ accepts if $\mathcal{P}$ passes the zero knowledge VPD protocol. Otherwise, $\mathcal{V}$ rejects. 
\end{enumerate}

\noindent
\textbf{Completeness}. The completeness property immediately follows from the construction of the protocol and the completeness of zero knowledge sumcheck and zero knowledge VPD. WE now proceed to argue about the soundness.\\

\noindent
\textbf{Soundness}. Let $\mathcal{P}^*$ be an cheating prover which convinces $\mathcal{V}$ of a claim ``Output = C(Input)'' for some Input and C such that Output $\neq$ C(Input). That means $\dot{V_0(0)} \neq \text{Output}$ in the beginning of the protocol. Supoose that we omit the soundness of zero knowledge VPD since all of them are negligible of $\lambda = \log |\mathbb{F}|$. We claim that if there exists $\dot{V}_i(r) \neq a_r$, then after this iteration with high probability either $(a)$ $\mathcal{V}$ rejects, or $(b)$ in the next iteration, $\dot{V}_{i+1}(r) \neq a_r$ or $\dot{V}_{i+1}(s) \neq a_s$. Since $\alpha_1$ and $\alpha_2$ are randomly chosen by $\mathcal{V}$, the probability that $\alpha_1 \dot{V}_i(r) + \alpha_2 \dot{V}_i(s) = \alpha_1 a_{r} + \alpha_2 a_{s}$ is $1/|\mathbb{F}|$ if $\dot{V}_i(r) \neq a_r$. Besides, according to the soundness of sumcheck protobol, when we run the protocol on a false claim with $s_{i} + 2s_{i+1} + 1 \leq 3 \log S$ variables and individual degree at most 3, the verifier $\mathcal{V}$ either rejects or passses the false claim to the next iteration with probability $1 - 9 \log S / (|\mathbb{F}| - 2)$.\\

That is to say, if $C(\text{Input}) \neq \dot{V}_0(0)$, the verifier $\mathcal{V}$ will accept with probability at most $\mathcal{O}(d \log S / |\mathcal{F}|)$, where $d$ is the depth of $C$ and $S$ is the maximum number of gates in one layer of $C$. Hence, the total soundness of the zero knowledge GKR protocol is negligible of $\lambda$.\\

\noindent
\textbf{Zero knowledge}. We prove that the protocol's has perfect zero knowledge by exhibiting a polynomial-time simulator $\mathcal{S}$ with $\text{Ouptut}$ and the circuit $C$ that perfectly samples the view of any malicious verifier. 

\begin{enumerate}

\item For every layer $i(0 \leq i \leq d)$ and the function $\dot{V}_i(\vec{z})$, sample $R_i^{sim} \in \mathbb{F}[X^{\leqslant 2}, Y^{\leqslant 2}]$ uniformly at random satisfying some conditions. Use $R_i^{sim}$ to answer queries to $R_i$.

\item For every layer function $\dot{V}_i(\vec{z})$, run the zero knowledge sumcheck simulator on input $(\mathbb{F}, \cdot)$, and use it to answer quries of the verifier $\mathcal{V}^*$. 

\item For the output layer(layer $0$), run the zero knowledge sumcheck simulator on the claim

$$\text{Output} = \dot{V}_0(0) = \sum_{g\in\{0,1\} u, v\in \{0,1\}^{s_1}}\tilde{\beta}(0, g)\tilde{mult}(g, u, v)(\dot{V}_1(u)\dot{V}_1(v))+\tilde{add}(g,u,v)(\dot{V}_1(u)+\dot{V}_1(v))$$ 
At the end of the zero knowledge sumcheck protocol, the simulator receives the random vector $\vec{q} = (t, \vec{r}, \vec{s})$ with with $t \in \mathbb{F}$ and $\vec{r}, \vec{s} \in \mathbb{F}^{s_1}$. If $r_1 = s_1$, abort. Otherwise, sample $\dot{V}_1(\vec{r})$ and $\dot{V}_1(\vec{s})$ at random conditioned on satifying the sumcheck protocol. 
\item For layer $i(1 \leq i \leq d - 1)$:
	\begin{itemize}
	\item Receive $\alpha_1$ and $\alpha_2$ from the verifier.
	\item Using the subsimulator for $\dot{V}_i$, simulate the strong zero knowledge sumcheck protocol on the claim
	$$\alpha_1 \dot{V}_i(\vec{r}) + \alpha_2 \dot{V}_i(\vec{s}) = \alpha_1 a_{\vec{r}} + \alpha_2 a_{\vec{s}}$$
	\item Then the simulator receives the random vector $\vec{q} = (\vec{t}, \vec{r}, \vec{s}, p)$ with $\vec{t} \in \mathbb{F}^{s_i}$ $\vec{r}, \vec{s} \in (\mathbb{F}-\{0, 1\})^{s_{i+1}}$ and $p \in \mathbb{F}$. 
	\item If $r_1 = s_1$, abort. 
	\item Otherwise, reply with the value
	\begin{align}
		\sum_{j = 1, 2} \alpha_j (\tilde{\beta}(\vec{z}, \vec{t})\tilde{mult}(\vec{t}, \vec{r}, \vec{s})(\dot{V}_{i+1}(\vec{r})\dot{V}_{i+1}(\vec{s}))&+\tilde{add}(\vec{t},\vec{r},\vec{s})(\dot{V}_{i+1}(\vec{r})+\dot{V}_{i+1}(\vec{s}))\\
 		&+ Z_i(\vec{z})\sum\limits_{c \in \{0, 1\}}R_i(z_1, c))
	\end{align}
	\item Sample $\dot{V}_{i+1}(\vec{r})$ and $\dot{V}_{i+1}(\vec{s})$ at random. And randomly choose the function $R^{sim}_i(X, Y)$ satisfying the above claim. The verifier does zero knowledge VPD on $R^{sim}_i(z_1, p)$.   
	\end{itemize}
\item For input layer $d$, the verifier uses zero knowledge VPD to verify the values of $\dot{V}_d(\vec{r})$ and $\dot{V}_d(\vec{s})$.
\end{enumerate} 

If we want to make it zero knowledge, we need to prove that $\{View_{V^*}(\mathcal{P}(\text{Output, C, Input}) \leftrightarrow \mathcal{V^*}(\text{Output, C}))\} \simeq_{c} \{\mathcal{S}^{\mathcal{V^*}}(\text{Output, C})\}$. We claim that in the real world execution, the distribution of $\dot{V}_i(\vec{r})$ and $\dot{V}_i(\vec{s})$ are also uniformly at random in $\mathbb{F}$. In the real world, for every mask function $R_i$, the verifier only knows the value of $R_i(r_1, p)$ and $R_i(s_1, p)$, where $r_1 \neq s_1$ and $r_1, s_1, p$ are randomly chosen by the verifier. If the verifier still have any no idea about the value of $\sum\limits_{c \in \{0, 1\}}R_i(r_1, c)$ and $\sum\limits_{c \in \{0, 1\}}R_i(s_1, c)$ conditioned on it, then $\dot{V}_i(\vec{r})$ and $\dot{V}_i(\vec{r})$ are uniformly at random.\\

Therefore, we only need to claim that $R(s, r), R(t, r), \sum\limits_{c \in \{0, 1\}}R(s, c), \sum\limits_{c \in \{0, 1\}}R(t, c)$ are independent if $R(x, y)$ are uniformly sampled from $\mathbb{F}[X^{\leqslant 2}, Y^{\leqslant 2}]$ and $s \neq t$. That is obvious since $s \neq t$ and both of the degrees of $X, Y$ are two. \\

Other things are also distinguishable for the verifier $\mathcal{V^*}$ because of zero knowledge VPD protocol and zero knowledge sumcheck protocol. So our entire protocol is zero knowledge, which completes our proof.\\

\noindent
\textbf{Complexity}. Consider the time complexity of zero knowledge GKR protocol. We would like to focus on the prover time. Since we have analyzed the prover time in our linear GKR protocol, we only need to think about the overhead complexity while maintaining zero knowledge for GKR protocol. For every layer of the circuit $C$, the prover samples $R_i(X, Y)$, runs the zeor knowledge sumcheck protocol for $s_i$ variables with individual degree at most $3$ and run the zero knowledge VPD for $R(X, Y)$ on $2$ random points. The total complexity is $\mathcal{O}(s_i^2)$ since the size of $R_i(X, Y)$ is only constant. Suppose the depth of the circuit $C$ is $d$ and the maximum number of gates in one layer is $S$. The total complexity is $\mathcal{O}(d \log^2 S)$. In addition, at the end of the protocol, the prover needs to run the zero knowledge VPD for $\dot{V}_d$ on 2 random points. It needs $\mathcal{O}(S)$. So the total complexity is $\mathcal{O}(S \times d)$, which is linear of the circuit size and it is optimal as the prover must evaluate the circuit $C$. 


















